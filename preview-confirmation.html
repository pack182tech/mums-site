<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preview - Order Confirmation</title>
    <link rel="icon" type="image/png" href="pack182logo.png">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        body {
            padding-top: 20px;
        }
        .preview-notice {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 10px;
            text-align: center;
            margin-bottom: 20px;
            font-weight: bold;
        }
    </style>
    <script src="js/config.js"></script>
    <script src="js/sheets-api.js"></script>
</head>
<body>
    <div class="preview-notice">
        üîí SECRET PREVIEW MODE - This is for testing only
    </div>

    <!-- Confirmation Screen -->
    <section id="confirmation-screen" class="confirmation-container">
        <div class="container">
            <div class="success-icon">‚úì</div>
            <h2>Order Submitted Successfully!</h2>
            
            <div class="order-details">
                <p class="order-id">Order ID: <strong id="confirmation-order-id">ORD-2024-1182</strong></p>
                <p>Total Amount: <strong id="confirmation-total">$45.00</strong></p>
            </div>
            
            <div id="payment-instructions" class="payment-section">
                <h3>Payment Instructions</h3>
                <div id="zelle-section" class="zelle-section">
                    <div class="zelle-content">
                        <div class="zelle-info">
                            <p class="payment-method-label">Pay with Zelle:</p>
                            <div class="payment-details">
                                <p>Send to: <strong id="zelle-email">pack182tech@gmail.com</strong></p>
                                <p>Recipient: <strong>Pack 182 Mums Sale</strong></p>
                                <p class="payment-note">‚ö†Ô∏è Include your order ID (<span id="payment-order-id">ORD-2024-1182</span>) in the memo</p>
                            </div>
                        </div>
                        <div class="qr-code-section">
                            <img id="zelle-qr" class="qr-code" src="" alt="Zelle QR Code">
                            <p class="qr-label">Scan with Zelle app</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="pickup-info">
                <h3>Pickup Information</h3>
                <p id="pickup-details">Loading pickup information...</p>
            </div>
            
            <div class="confirmation-actions">
                <button onclick="window.print()" class="btn btn-secondary">Print Receipt</button>
                <button onclick="window.location.href='index.html'" class="btn btn-primary">Back to Main Site</button>
            </div>
        </div>
    </section>

    <script>
        // Load actual settings and generate QR code
        document.addEventListener('DOMContentLoaded', async function() {
            const orderId = 'ORD-2024-1182';
            
            try {
                // Load actual settings from API
                const settings = await sheetsAPI.getSettings();
                
                // Update Zelle email from settings
                const zelleEmailElement = document.getElementById('zelle-email');
                const zelleEmail = settings.zelle_email || 'pack182tech@gmail.com';
                if (zelleEmailElement) {
                    zelleEmailElement.textContent = zelleEmail;
                }
                
                // Generate QR code with memo
                const memo = `Order: ${orderId}`;
                const qrData = `ZELLE:${zelleEmail}?memo=${encodeURIComponent(memo)}`;
                
                // Use custom QR URL from settings or generate with memo
                const qrUrl = settings.zelle_qr_url && !settings.zelle_qr_url.includes('${orderId}') 
                    ? settings.zelle_qr_url  // Use static QR if configured
                    : `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(qrData)}`;
                
                const zelleQR = document.getElementById('zelle-qr');
                if (zelleQR) {
                    zelleQR.src = qrUrl;
                }
                
                // Set pickup details from settings
                const pickupInfo = `${settings.pickup_location || 'Location TBD'}<br>${settings.pickup_date || 'Date TBD'}`;
                document.getElementById('pickup-details').innerHTML = pickupInfo;
                
                // Update payment instructions if available
                if (settings.payment_instructions) {
                    const paymentNote = document.querySelector('.payment-note');
                    if (paymentNote && !settings.payment_instructions.toLowerCase().includes('order id')) {
                        // Only update if the settings don't already mention order ID
                        paymentNote.innerHTML = `‚ö†Ô∏è ${settings.payment_instructions}<br>Include your order ID (<span id="payment-order-id">${orderId}</span>) in the memo`;
                    }
                }
                
            } catch (error) {
                console.error('Failed to load settings:', error);
                // Use defaults if settings fail to load
                const zelleEmail = 'pack182tech@gmail.com';
                const memo = `Order: ${orderId}`;
                const qrData = `ZELLE:${zelleEmail}?memo=${encodeURIComponent(memo)}`;
                const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(qrData)}`;
                
                const zelleQR = document.getElementById('zelle-qr');
                if (zelleQR) {
                    zelleQR.src = qrUrl;
                }
                
                // Use default pickup info
                document.getElementById('pickup-details').innerHTML = 'TBD - Will be announced via email<br>Saturday Date TBD 9am-2pm';
            }
        });
    </script>
</body>
</html>